var cookieData,messageInputElement=document.getElementById("message-input"),submitButtonElement=document.getElementById("submit-button"),drawerHandleElement=document.querySelector(".drawer-handle"),userInputElement=document.getElementById("username"),bogusUsernameElement=document.querySelector(".bogus-username"),inUseUsernameElement=document.querySelector(".in-use-username"),checkingUsernameElement=document.querySelector(".checking-username"),usernameLookupSuccessElement=document.querySelector(".username-lookup-success"),tinyHeaderUserNameElement=document.querySelector(".tiny-header-user-name"),currentUserName="",currentUserGUID="";try{cookieData=JSON.parse(getCookie("userData"))}catch(e){}cookieData?(currentUserName=cookieData.username,userInputElement.value=cookieData.username,tinyHeaderUserNameElement.innerHTML=cookieData.username||"someone",currentUserGUID=cookieData.guid):tinyHeaderUserNameElement.innerHTML="someone";var networkPort=3e3,validUserPattern=/^[a-z0-9_-]{1,16}$/,socket=io();userInputElement.addEventListener("keydown",e=>{"Enter"!=e.key&&"NumpadEnter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),"Enter"==e.key||"NumpadEnter"==e.key?closeDrawerFocusMessageInput():e.shiftKey&&"Tab"==e.key?submitButtonElement.focus():"Tab"==e.key&&messageInputElement.focus())});let timer=null;userInputElement.addEventListener("keyup",e=>{let n=e.target.value;clearUsernameValidationDisplays(),n!=currentUserName&&(validUserPattern.test(n)?(checkingUsernameElement.style.display="inline",clearTimeout(timer),timer=setTimeout(()=>{socket.emit("username_update",{username:n,guid:currentUserGUID})},1e3)):bogusUsernameElement.style.display="inline")}),socket.on("username_update_response",e=>{e.foundDuplicate?(clearUsernameValidationDisplays(),inUseUsernameElement.style.display="inline"):(currentUserName=e.username,tinyHeaderUserNameElement.innerHTML=currentUserName||"someone",clearUsernameValidationDisplays(),usernameLookupSuccessElement.classList.remove("off"),setTimeout(()=>{usernameLookupSuccessElement.classList.add("off")},0))});var userInputMouseDown=!1,userInputArrivedByTab=!1;function openDrawer(){document.body.classList.add("drawer-is-open"),document.getElementById("username").value=currentUserName||"",clearUsernameValidationDisplays()}function closeDrawer(){document.body.classList.remove("drawer-is-open"),tinyHeaderUserNameElement.innerHTML=currentUserName||"someone"}function toggleDrawerFreeFLoat(){drawerIsOpen()?closeDrawer():openDrawer()}function closeDrawerFocusMessageInput(){closeDrawer(),messageInputElement.focus()}function drawerIsOpen(){return!!document.body.classList.contains("drawer-is-open")}function clearUsernameValidationDisplays(){inUseUsernameElement.style.display="none",bogusUsernameElement.style.display="none",checkingUsernameElement.style.display="none"}function getCookie(e){let n=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?decodeURIComponent(n[1]):void 0}function setCookie(e,n,t={}){(t={path:"/",...t}).expires instanceof Date&&(t.expires=t.expires.toUTCString());let r=encodeURIComponent(e)+"="+encodeURIComponent(n);for(let e in t){r+="; "+e;let n=t[e];!0!==n&&(r+="="+n)}document.cookie=r}document.body.addEventListener("mousedown",(function(e){"username"!=e.targetid&&(userInputArrivedByTab=!1)})),userInputElement.addEventListener("mousedown",(function(){userInputMouseDown=!0})),userInputElement.addEventListener("focusin",(function(){userInputMouseDown||drawerIsOpen()||(openDrawer(),userInputArrivedByTab=!0),userInputMouseDown=!1})),userInputElement.addEventListener("blur",e=>{userInputArrivedByTab&&closeDrawer(),userInputArrivedByTab=!1,tinyHeaderUserNameElement.innerHTML=currentUserName||"someone"}),drawerHandleElement.addEventListener("click",toggleDrawerFreeFLoat),document.getElementById("form").addEventListener("submit",e=>{e.preventDefault();let n=messageInputElement.value;if(!n)return!1;let t=currentUserName||"someone";socket.emit("chat_message",{text:n,username:t})}),socket.on("chat_message_response",e=>{userInputElement.value;const n=`<div class='${currentUserName==e.username?"message-output is-current-user":"message-output"}'><div class='user-name'><span>${e.username}</span></div><p class='output-text'>${e.text}</p></div>`;$(n).appendTo("#messages"),messageInputElement.value=""});