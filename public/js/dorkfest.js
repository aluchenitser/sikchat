var messageInputElement=document.getElementById("message-input");var submitButtonElement=document.getElementById("submit-button");var drawerHandleElement=document.querySelector(".drawer-handle");var userInputElement=document.getElementById("username");var bogusUsernameElement=document.querySelector(".bogus-username");var inUseUsernameElement=document.querySelector(".in-use-username");var checkingUsernameElement=document.querySelector(".checking-username");var usernameLookupSuccessElement=document.querySelector(".username-lookup-success");var tinyHeaderUserNameElement=document.querySelector(".tiny-header-user-name");var currentUserName="";var currentUserGUID="";var cookieData;try{cookieData=JSON.parse(getCookie("userData"))}catch(e){}if(cookieData){currentUserName=cookieData.username;userInputElement.value=cookieData.username;tinyHeaderUserNameElement.innerHTML=cookieData.username||"someone";currentUserGUID=cookieData.guid}else{tinyHeaderUserNameElement.innerHTML="someone"}var networkPort=3e3;var validUserPattern=/^[a-z0-9_-]{1,16}$/;var socket=io();userInputElement.addEventListener("keydown",e=>{if(e.key=="Enter"||e.key=="NumpadEnter"||e.key=="Tab"){e.preventDefault();if(e.key=="Enter"||e.key=="NumpadEnter"){closeDrawerFocusMessageInput()}else if(e.shiftKey&&e.key=="Tab"){submitButtonElement.focus()}else if(e.key=="Tab"){messageInputElement.focus()}}});userInputElement.addEventListener("keyup",e=>{let username=e.target.value;clearUsernameValidationDisplays();if(username==currentUserName)return;if(validUserPattern.test(username)){checkingUsernameElement.style.display="inline";clearTimeout(timer);timer=setTimeout(()=>{socket.emit("username_update",{username:username,guid:currentUserGUID})},1e3)}else{bogusUsernameElement.style.display="inline"}});socket.on("username_update_response",msg=>{if(msg.foundDuplicate){clearUsernameValidationDisplays();inUseUsernameElement.style.display="inline"}else{currentUserName=msg.username;tinyHeaderUserNameElement.innerHTML=currentUserName||"someone";clearUsernameValidationDisplays();usernameLookupSuccessElement.classList.remove("off");setTimeout(()=>{usernameLookupSuccessElement.classList.add("off")},0)}});var userInputMouseDown=false;var userInputArrivedByTab=false;document.body.addEventListener("mousedown",(function(e){if(e.targetid!="username"){userInputArrivedByTab=false}}));userInputElement.addEventListener("mousedown",(function(){userInputMouseDown=true}));userInputElement.addEventListener("focusin",(function(){if(!userInputMouseDown&&!drawerIsOpen()){openDrawer();userInputArrivedByTab=true}userInputMouseDown=false}));userInputElement.addEventListener("blur",e=>{if(userInputArrivedByTab)closeDrawer();userInputArrivedByTab=false;tinyHeaderUserNameElement.innerHTML=currentUserName||"someone"});drawerHandleElement.addEventListener("click",toggleDrawerFreeFLoat);document.getElementById("form").addEventListener("submit",e=>{e.preventDefault();let text=messageInputElement.value;if(!text)return false;let username=currentUserName||"someone";socket.emit("chat_message",{text:text,username:username})});socket.on("chat_message_response",msg=>{let user=userInputElement.value||"someone";let messageClass=currentUserName==msg.username?"message-output is-current-user":"message-output";const markup=`<div class='${messageClass}'><div class='user-name'><span>${msg.username}</span></div><p class='output-text'>${msg.text}</p></div>`;$(markup).appendTo("#messages");messageInputElement.value=""});function openDrawer(){document.body.classList.add("drawer-is-open");document.getElementById("username").value=currentUserName||"";clearUsernameValidationDisplays()}function closeDrawer(){document.body.classList.remove("drawer-is-open");tinyHeaderUserNameElement.innerHTML=currentUserName||"someone"}function toggleDrawerFreeFLoat(){drawerIsOpen()?closeDrawer():openDrawer()}function closeDrawerFocusMessageInput(){closeDrawer();messageInputElement.focus()}function drawerIsOpen(){return document.body.classList.contains("drawer-is-open")?true:false}function clearUsernameValidationDisplays(){inUseUsernameElement.style.display="none";bogusUsernameElement.style.display="none";checkingUsernameElement.style.display="none"}function getCookie(name){let matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):undefined}function setCookie(name,value,options={}){options={path:"/",...options};if(options.expires instanceof Date){options.expires=options.expires.toUTCString()}let updatedCookie=encodeURIComponent(name)+"="+encodeURIComponent(value);for(let optionKey in options){updatedCookie+="; "+optionKey;let optionValue=options[optionKey];if(optionValue!==true){updatedCookie+="="+optionValue}}document.cookie=updatedCookie}